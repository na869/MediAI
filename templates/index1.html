{% extends "base.html" %}

{% block content %}
<script>
    document.querySelector('.navbar').classList.add('navbar-standard');
</script>
<div class="container py-5 mt-lg-5">
    <div class="row justify-content-center">
        <div class="col-xl-11 reveal">
            <div class="premium-card p-0 overflow-hidden border-0 shadow-lg bg-white">
                <div class="row g-0">
                    <!-- Informational Sidebar -->
                    <div class="col-lg-4 bg-primary text-white p-5 d-flex flex-column">
                        <div class="mb-5">
                            <div class="bg-accent text-white p-3 rounded-4 d-inline-block mb-4 shadow-lg">
                                <i class="fa-solid fa-laptop-medical fa-2x"></i>
                            </div>
                            <h2 class="fw-800">Elite CDSS Engine</h2>
                            <p class="opacity-75 small">Our Clinical Decision Support System utilizes weighted ensemble intelligence to resolve complex diagnostic vectors.</p>
                        </div>
                        <div class="mt-auto space-y-4">
                            <div class="d-flex align-items-center mb-3"><i class="fa-solid fa-circle-check text-accent me-3"></i><span class="smaller fw-bold text-uppercase">Multi-Stage Inference</span></div>
                            <div class="d-flex align-items-center"><i class="fa-solid fa-circle-check text-accent me-3"></i><span class="smaller fw-bold text-uppercase">Longevity Projection</span></div>
                        </div>
                    </div>

                    <!-- Main Form -->
                    <div class="col-lg-8 p-5 bg-white">
                        <div class="d-flex justify-content-between align-items-center mb-5">
                            <div>
                                <h3 class="fw-900 mb-1 text-primary-dark">Clinical Assessment</h3>
                                <p class="text-slate small mb-0 fw-bold">Step 1: Patient Biometrics & Symptom Inventory</p>
                            </div>
                            <span class="stat-pill shadow-sm">v3.5 READY</span>
                        </div>

                        <form method="POST" action="">
                            {{ form.hidden_tag() }}

                            <!-- Biometrics Section (High Visibility) -->
                            <div class="row g-4 mb-5 p-4 rounded-4" style="background-color: #f8fafc; border: 1px solid #e2e8f0;">
                                <div class="col-12">
                                    <label class="form-label small fw-900 text-primary-dark text-uppercase ls-1">Patient Full Name</label>
                                    {{ form.patient_name(class="form-control border-secondary border-opacity-25 shadow-sm", placeholder="Enter legal name") }}
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label small fw-900 text-primary-dark text-uppercase ls-1">Age (Years)</label>
                                    {{ form.age(class="form-control border-secondary border-opacity-25 shadow-sm") }}
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label small fw-900 text-primary-dark text-uppercase ls-1">Biological Gender</label>
                                    {{ form.sex(class="form-select border-secondary border-opacity-25 shadow-sm") }}
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label small fw-900 text-primary-dark text-uppercase ls-1">BP Class</label>
                                    {{ form.bp(class="form-select border-secondary border-opacity-25 shadow-sm") }}
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label small fw-900 text-primary-dark text-uppercase ls-1">Cholesterol</label>
                                    {{ form.cholesterol(class="form-select border-secondary border-opacity-25 shadow-sm") }}
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label small fw-900 text-primary-dark text-uppercase ls-1">Na to K Ratio</label>
                                    {{ form.na_to_k(class="form-control border-secondary border-opacity-25 shadow-sm") }}
                                </div>
                            </div>

                            <!-- Symptoms Section -->
                            <div class="mb-5">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <label class="form-label small fw-900 text-primary-dark text-uppercase ls-1 mb-0">Symptom Inventory</label>
                                    <span id="selectedCount" class="badge bg-primary text-white px-4 py-2 rounded-pill fw-900 h6 mb-0">0 SELECTED</span>
                                </div>

                                <!-- Search -->
                                <div class="input-group mb-4">
                                    <span class="input-group-text bg-white border-end-0"><i class="fa-solid fa-magnifying-glass text-muted"></i></span>
                                    <input type="text" id="symptomSearch" class="form-control border-start-0 ps-0" placeholder="Search through 30+ diagnostic markers...">
                                </div>
                                
                                <!-- Symptom Grid -->
                                <div class="symptom-box shadow-inner p-3 rounded-4" style="background: #f1f5f9; border: 1px solid #e2e8f0; max-height: 250px; overflow-y: auto;">
                                    <div class="row g-2" id="symptomContainer">
                                        {% for value, label in form.symptoms.choices %}
                                        <div class="col-auto symptom-item" data-label="{{ label | lower }}">
                                            <input class="form-check-input d-none" type="checkbox" name="symptoms" value="{{ value }}" id="symp_{{ value }}" onchange="updateVisualState(this)">
                                            <label class="symptom-pill" for="symp_{{ value }}">
                                                {{ label }}
                                            </label>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>

                            <button type="submit" class="btn-premium btn-accent w-100 py-4 shadow-lg border-0 text-white fw-900 h4" style="background: #10B981 !important;">
                                <i class="fa-solid fa-wand-magic-sparkles me-3"></i> EXECUTE INFERENCE ENGINE
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function updateVisualState(checkbox) {
    const label = document.querySelector(`label[for="${checkbox.id}"]`);
    const countEl = document.getElementById('selectedCount');
    const checkedCount = document.querySelectorAll('input[name="symptoms"]:checked').length;
    countEl.innerText = checkedCount + ' SELECTED';
    if (checkbox.checked) { label.classList.add('active'); } 
    else { label.classList.remove('active'); }
}

document.getElementById('symptomSearch').addEventListener('input', function(e) {
    const term = e.target.value.toLowerCase();
    document.querySelectorAll('.symptom-item').forEach(item => {
        item.style.display = item.getAttribute('data-label').includes(term) ? 'block' : 'none';
    });
});
</script>

<style>
    .symptom-pill {
        display: inline-block; padding: 0.6rem 1.25rem; background: #ffffff;
        border: 2px solid #e2e8f0; border-radius: 100px; font-size: 0.85rem;
        font-weight: 800; color: #475569; cursor: pointer; transition: all 0.2s ease;
    }
    .symptom-pill.active {
        background: var(--brand-accent) !important; border-color: var(--brand-accent) !important;
        color: white !important; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); transform: scale(1.05);
    }
    .symptom-pill:hover { border-color: var(--brand-accent); background: #f8fafc; }
    .shadow-inner { box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.05); }
    .fw-900 { font-weight: 900; }
    .stat-pill { background: #fff; border: 1px solid var(--card-border); padding: 0.5rem 1.25rem; border-radius: 100px; font-size: 0.75rem; font-weight: 800; color: var(--brand-accent); }
    .btn-premium { border-radius: 100px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; transition: all 0.3s ease; border: none; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; }
</style>
{% endblock %}